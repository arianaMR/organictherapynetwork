{"version":3,"file":"reinspect.esm.js","sources":["../src/context.ts","../src/StateInspector.tsx","../src/useReducer.ts","../src/useState.ts"],"sourcesContent":["import React, { Reducer } from \"react\"\nimport { Store } from \"redux\"\n\ntype UnsubscribeFn = () => void\n\nexport type EnhancedStore = Store & {\n  registerHookedReducer: (\n    reducer: Reducer<any, any>,\n    initialState: any,\n    reducerId: string | number\n  ) => UnsubscribeFn\n}\n\nexport const StateInspectorContext = React.createContext<\n  EnhancedStore | undefined\n>(undefined)\n","import React, { ReducerAction, Reducer, useMemo, useEffect } from \"react\"\nimport { createStore } from \"redux\"\nimport { EnhancedStore, StateInspectorContext } from \"./context\"\n\ndeclare global {\n  interface Window {\n    __REDUX_DEVTOOLS_EXTENSION__?: any\n  }\n}\n\ninterface StateInspectorProps {\n  name?: string\n  initialState?: any\n}\n\ninterface StoreReducerAction {\n  type: string\n  payload: any\n}\n\nconst omit = (obj: Record<string, any>, keyToRemove: string) =>\n  Object.keys(obj)\n    .filter(key => key !== keyToRemove)\n    .reduce<Record<string, any>>((acc, key) => {\n      acc[key] = obj[key]\n\n      return acc\n    }, {})\n\nexport const StateInspector: React.FC<StateInspectorProps> = ({\n  name,\n  initialState = {},\n  children\n}) => {\n  const store = useMemo<EnhancedStore | undefined>(() => {\n    if (typeof window === \"undefined\" || !window.__REDUX_DEVTOOLS_EXTENSION__) {\n      return undefined\n    }\n\n    const registeredReducers: Record<\n      string | number,\n      Reducer<any, ReducerAction<any>>\n    > = {}\n\n    const storeReducer: Reducer<any, StoreReducerAction> = (state, action) => {\n      const actionReducerId = action.type.split(\"/\")[0]\n      const isInitAction = /\\/_init$/.test(action.type)\n      const isTeardownAction = /\\/_teardown$/.test(action.type)\n\n      const currentState = isTeardownAction\n        ? omit(state, actionReducerId)\n        : { ...state }\n\n      return Object.keys(registeredReducers).reduce((acc, reducerId) => {\n        const reducer = registeredReducers[reducerId]\n        const reducerState = state[reducerId]\n        const reducerAction = action.payload\n        const isForCurrentReducer = actionReducerId === reducerId\n\n        if (isForCurrentReducer) {\n          acc[reducerId] = isInitAction\n            ? action.payload\n            : reducer(reducerState, reducerAction)\n        } else {\n          acc[reducerId] = reducerState\n        }\n\n        return acc\n      }, currentState)\n    }\n\n    const store: EnhancedStore = createStore(\n      storeReducer,\n      initialState,\n      window.__REDUX_DEVTOOLS_EXTENSION__({\n        name: name || \"React state\",\n        actionsBlacklist: [\"/_init\", \"/_teardown\"]\n      })\n    )\n\n    store.registerHookedReducer = (reducer, initialState, reducerId) => {\n      registeredReducers[reducerId] = reducer\n\n      store.dispatch({\n        type: `${reducerId}/_init`,\n        payload: initialState\n      })\n\n      return () => {\n        delete registeredReducers[reducerId]\n\n        store.dispatch({\n          type: `${reducerId}/_teardown`\n        })\n      }\n    }\n\n    return store\n  }, [])\n\n  useEffect(() => {\n    store && store.dispatch({ type: \"REINSPECT/@@INIT\", payload: {} })\n  }, [])\n\n  return (\n    <StateInspectorContext.Provider value={store}>\n      {children}\n    </StateInspectorContext.Provider>\n  )\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport {\n  useReducer as useReactReducer,\n  Reducer,\n  useMemo,\n  Dispatch,\n  useState,\n  useEffect,\n  useContext,\n  ReducerState,\n  ReducerAction\n} from \"react\"\nimport { StateInspectorContext, EnhancedStore } from \"./context\"\n\nexport function useHookedReducer<S, A>(\n  reducer: Reducer<S, A>,\n  initialState: S,\n  store: EnhancedStore,\n  reducerId: string | number\n): [S, Dispatch<A>] {\n  const initialReducerState = useMemo(() => {\n    const initialStateInStore = store.getState()[reducerId]\n    return initialStateInStore === undefined\n      ? initialState\n      : initialStateInStore\n  }, [])\n\n  const [localState, setState] = useState<S>(initialReducerState)\n\n  const dispatch = useMemo<Dispatch<A>>(() => {\n    const dispatch = (action: any) => {\n      if (\n        action &&\n        typeof action === \"object\" &&\n        typeof action.type === \"string\"\n      ) {\n        store.dispatch({\n          type: `${reducerId}/${action.type}`,\n          payload: action\n        })\n      } else {\n        store.dispatch({\n          type: reducerId,\n          payload: action\n        })\n      }\n    }\n\n    return dispatch\n  }, [])\n\n  useEffect(() => {\n    const teardown = store.registerHookedReducer(\n      reducer,\n      initialReducerState,\n      reducerId\n    )\n\n    let lastReducerState = localState\n    const unsubscribe = store.subscribe(() => {\n      const storeState: any = store.getState()\n      const reducerState = storeState[reducerId]\n\n      if (lastReducerState !== reducerState) {\n        setState(reducerState)\n      }\n\n      lastReducerState = reducerState\n    })\n\n    return () => {\n      unsubscribe()\n      teardown()\n    }\n  }, [])\n\n  return [localState, dispatch]\n}\n\nexport function useReducer<R extends Reducer<any, any>>(\n  reducer: R,\n  initialState: ReducerState<R>,\n  id?: string | number\n): [ReducerState<R>, Dispatch<ReducerAction<R>>]\nexport function useReducer<R extends Reducer<any, any>, I>(\n  reducer: R,\n  initialState: I,\n  initializer: (arg: I) => ReducerState<R>,\n  id?: string | number\n): [ReducerState<R>, Dispatch<ReducerAction<R>>]\nexport function useReducer<R extends Reducer<any, any>, I>(\n  reducer: R,\n  initialState: I & ReducerState<R>,\n  initializer: (arg: I & ReducerState<R>) => ReducerState<R>,\n  id?: string | number\n): [ReducerState<R>, Dispatch<ReducerAction<R>>]\nexport function useReducer<R extends Reducer<any, any>, I>(\n  reducer: R,\n  initialState: I & ReducerState<R>,\n  ...args: any[]\n) {\n  let id: string | number | undefined\n  let initializer: (arg: I | (I & ReducerState<R>)) => ReducerState<R> = args[0]\n\n  if (args.length === 2) {\n    initializer = args[0]\n    id = args[1]\n  } else if (typeof args[0] === \"string\" || typeof args[0] === \"number\") {\n    id = args[0]\n  } else {\n    initializer = args[0]\n    id = args[1]\n  }\n\n  const store = useContext(StateInspectorContext)\n\n  const initializedState = initializer\n    ? initializer(initialState)\n    : initialState\n\n  return store && id\n    ? useHookedReducer(reducer, initializedState, store, id)\n    : useReactReducer(reducer, initialState, initializer)\n}\n","/* eslint-disable react-hooks/rules-of-hooks */\nimport { useHookedReducer } from \"./useReducer\"\nimport { useMemo, useContext, useState as useReactState } from \"react\"\nimport { EnhancedStore, StateInspectorContext } from \"./context\"\n\ntype StateAction<S> = S | ((s: S) => S)\n\nfunction stateReducer<S>(state: S, action: StateAction<S>): S {\n  return typeof action === \"function\" ? (action as (s: S) => S)(state) : action\n}\n\nexport const useState = <S>(\n  initialState: S | (() => S),\n  id: string | number\n) => {\n  const inspectorStore = useContext(StateInspectorContext)\n  // Keeping the first values\n  const [store, reducerId] = useMemo<\n    [EnhancedStore | undefined, string | number]\n  >(() => [inspectorStore, id], [])\n\n  if (!store || !reducerId) {\n    return useReactState<S>(initialState)\n  }\n\n  const finalInitialState = useMemo<S>(\n    () =>\n      typeof initialState === \"function\"\n        ? (initialState as () => S)()\n        : initialState,\n    []\n  )\n\n  return useHookedReducer<S, any>(\n    stateReducer,\n    finalInitialState,\n    store,\n    reducerId\n  )\n}\n"],"names":["StateInspectorContext","React","createContext","undefined","omit","obj","keyToRemove","Object","keys","filter","key","reduce","acc","StateInspector","name","initialState","children","store","useMemo","window","__REDUX_DEVTOOLS_EXTENSION__","registeredReducers","storeReducer","state","action","actionReducerId","type","split","isInitAction","test","isTeardownAction","currentState","reducerId","reducer","reducerState","reducerAction","payload","isForCurrentReducer","createStore","actionsBlacklist","registerHookedReducer","dispatch","useEffect","Provider","value","useHookedReducer","initialReducerState","initialStateInStore","getState","useState","localState","setState","teardown","lastReducerState","unsubscribe","subscribe","storeState","useReducer","id","initializer","useContext","initializedState","useReactReducer","stateReducer","inspectorStore","useReactState","finalInitialState"],"mappings":"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"}