# Redux Interceptor Middleware

A collection of toos around a middleware for Redux with the following features

- register interceptor functions
- provide a resource interceptor

## installing the middleware

```js
import { middleware } from 'redux-interceptor';

const store = createStore( //redux default
  reducer, // retrieve the rule based reducer from the package
  applyMiddleware(
    thunk, // other middleware probably should be chained BEFORE the interceptor
    middleware // interceptor middleware
  )
);
```

## register an interceptor

```js
import { createInterceptor } from 'redux-interceptor';

const logInterceptor = createInterceptor('log', (type, payload, dispatch))

register(/^log:/, (action, dispatch) => {
  console.log(action.payload);
});

dispatch({
  type: 'log:time',
  payload: Date.now()
});
```

## request resources with resource interceptor

```js
import { resourceInterceptor } from 'redux-interceptor'

resourceInterceptor.setResources([{
  name: 'current-user',
  url: '/api/user/me'
}]).register();

// handle loading
register(/^resource:/, (action, dispatch) => {
  dispatch({type: 'add-loading', payload: action.type.split(':')[1]})
});

register(/^resource-end:/, (action, dispatch) => {
  dispatch({type: 'remove-loading', payload: action.type.split(':')[1]})
});


// dispatch an action somewhere in the code
dispatch({
  type: resourceInterceptor.type('current-user'), {
    resource: 'current-user',
    successAction: 'add-user',
    errorAction: 'set-application-error'
  }
});

interceptor.addRule(/^resource:(.+)$/, (intercept, dispatch, match) => {
  dispatch({
    type: 'add-loading',
    payload: match[0]
  });
  intercept.then(data => dispa)
});

// fetch interceptor
const interceptor = interceptorManager.create('fetch', (type, payload, dispatch) => {
  dispatch({type: 'add-loading:' + type})
  fetch(payload.url, payload)
    .then(res => res.json())
    .then(data => dispatch({type:'remove-loading:' + type}) && dispatch({type:'result:' + type, payload: data}));
});

interceptor.addRule('get:user',  action => `/api/users/${action.payload.id}`);
dispatch({
  type: 'get:user',
  payload: {
    id: 1
  }
});


```
